<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Phylogenetic Missing Data Imputation • because.phybase</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Phylogenetic Missing Data Imputation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">because.phybase</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/03_phylogenetic_models.html">Phylogenetic Models</a></li>
    <li><a class="dropdown-item" href="../articles/04_missing_data.html">Phylogenetic Missing Data Imputation</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://because-pkg.github.io">because</a></li>
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/because-pkg/because.phybase/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Phylogenetic Missing Data Imputation</h1>
                        <h4 data-toc-skip class="author">Achaz von
Hardenberg</h4>
            
            <h4 data-toc-skip class="date">2025-12-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/because-pkg/because.phybase/blob/main/vignettes/04_missing_data.Rmd" class="external-link"><code>vignettes/04_missing_data.Rmd</code></a></small>
      <div class="d-none name"><code>04_missing_data.Rmd</code></div>
    </div>

    
    
<p>The <code>because</code> package handles missing values (NAs)
automatically using Bayesian imputation. Unlike frequentist methods that
often require deleting rows with missing values (list-wise deletion),
<code>because</code> treats missing values as unknown parameters to be
estimated by the model.</p>
<p>When installing the <code>because.phybase</code> extension,
<code>because</code> handles missing values imputation using also the
information available in the phylogenetic correlations among species
both in the response nodes (imputing both based on the predictors as
well as the phylogenetic correlations) as well as in parent-only nodes
(Automatically treating the node as a response variable to enable
phylogenetic imputation.</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>First, let’s load the package and the standard <code>rhino</code>
dataset.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://because-pkg.github.io/because.phybase/">because.phybase</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">rhino.dat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">rhino.tree</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulating-missing-data">Simulating Missing Data<a class="anchor" aria-label="anchor" href="#simulating-missing-data"></a>
</h2>
<p>We will artificially introduce missing values (<code>NA</code>) into
the dataset to demonstrate how <code>because</code> handles them. We’ll
add missingness to: * <code>LS</code> (Litter Size): A response variable
in our model. * <code>BM</code> (Body Mass): A parent-only variable.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a copy of the data</span></span>
<span><span class="va">rhino_na</span> <span class="op">&lt;-</span> <span class="va">rhino.dat</span></span>
<span></span>
<span><span class="co"># Introduce 10% missing values in Litter Size (Response)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">na_indices_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">rhino_na</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">rhino_na</span><span class="op">$</span><span class="va">LS</span><span class="op">[</span><span class="va">na_indices_ls</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="co"># Introduce 5% missing values in Body Mass (Predictor)</span></span>
<span><span class="va">na_indices_bm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">rhino_na</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">rhino_na</span><span class="op">$</span><span class="va">BM</span><span class="op">[</span><span class="va">na_indices_bm</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="co"># Verify missingness</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">rhino_na</span><span class="op">$</span><span class="va">LS</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">rhino_na</span><span class="op">$</span><span class="va">BM</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-model">The Model<a class="anchor" aria-label="anchor" href="#the-model"></a>
</h2>
<p>We define the same structural equation model (sem8) as in the
previous <a href="03_phylogenetic_model.html">vignette</a>: * Body Mass
(<code>BM</code>) affects Litter Size (<code>LS</code>) and Nose Length
(<code>NL</code>). * Range Size (<code>RS</code>) affects Nose Length
(<code>NL</code>). * Nose Length (<code>NL</code>) affects Dispersal
Distance (<code>DD</code>).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sem8.eq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="va">LS</span> <span class="op">~</span> <span class="va">BM</span>,</span>
<span>  <span class="va">NL</span> <span class="op">~</span> <span class="va">BM</span> <span class="op">+</span> <span class="va">RS</span>,</span>
<span>  <span class="va">DD</span> <span class="op">~</span> <span class="va">NL</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="running-the-model">Running the Model<a class="anchor" aria-label="anchor" href="#running-the-model"></a>
</h2>
<p>When we run <code><a href="https://rdrr.io/pkg/because/man/because.html" class="external-link">because()</a></code> with missing data, it
automatically detects the <code>NA</code> values and adjusts the JAGS
model structure.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sem8_na.bc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/because/man/because.html" class="external-link">because</a></span><span class="op">(</span></span>
<span>  equations <span class="op">=</span> <span class="va">sem8.eq</span>,</span>
<span>  data <span class="op">=</span> <span class="va">rhino_na</span>,</span>
<span>  structure <span class="op">=</span> <span class="va">rhino.tree</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sem8_na.bc</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#                  Mean    SD Naive SE Time-series SE   2.5%    50% 97.5%</span></span>
<span><span class="co"># alphaBM         1.283 0.545    0.010          0.029  0.170  1.294 2.348</span></span>
<span><span class="co"># alphaDD         0.574 0.280    0.005          0.007  0.030  0.566 1.133</span></span>
<span><span class="co"># alphaLS         0.346 0.407    0.007          0.015 -0.496  0.362 1.113</span></span>
<span><span class="co"># alphaNL        -0.014 0.330    0.006          0.013 -0.659 -0.007 0.655</span></span>
<span><span class="co"># beta_DD_NL      0.538 0.076    0.001          0.001  0.394  0.539 0.687</span></span>
<span><span class="co"># beta_LS_BM      0.478 0.092    0.002          0.002  0.296  0.479 0.656</span></span>
<span><span class="co"># beta_NL_BM      0.457 0.070    0.001          0.002  0.316  0.458 0.595</span></span>
<span><span class="co"># beta_NL_RS      0.601 0.067    0.001          0.001  0.468  0.602 0.732</span></span>
<span><span class="co"># lambdaBM        0.809 0.088    0.002          0.003  0.592  0.827 0.931</span></span>
<span><span class="co"># lambdaDD        0.455 0.130    0.002          0.003  0.213  0.453 0.705</span></span>
<span><span class="co"># lambdaLS        0.656 0.116    0.002          0.003  0.409  0.668 0.848</span></span>
<span><span class="co"># lambdaNL        0.722 0.089    0.002          0.002  0.525  0.731 0.868</span></span>
<span><span class="co"># sigma_BM_phylo  1.750 0.260    0.005          0.008  1.244  1.745 2.255</span></span>
<span><span class="co"># sigma_BM_res    0.812 0.135    0.002          0.004  0.581  0.799 1.099</span></span>
<span><span class="co"># sigma_DD_phylo  0.793 0.171    0.003          0.004  0.497  0.781 1.158</span></span>
<span><span class="co"># sigma_DD_res    0.858 0.088    0.002          0.002  0.690  0.854 1.033</span></span>
<span><span class="co"># sigma_LS_phylo  1.188 0.208    0.004          0.005  0.811  1.175 1.614</span></span>
<span><span class="co"># sigma_LS_res    0.837 0.113    0.002          0.002  0.629  0.829 1.067</span></span>
<span><span class="co"># sigma_NL_phylo  1.037 0.150    0.003          0.004  0.772  1.029 1.366</span></span>
<span><span class="co"># sigma_NL_res    0.628 0.079    0.001          0.002  0.488  0.622 0.798</span></span>
<span><span class="co">#                 Rhat n.eff</span></span>
<span><span class="co"># alphaBM        1.004   356</span></span>
<span><span class="co"># alphaDD        1.000  1437</span></span>
<span><span class="co"># alphaLS        1.002   734</span></span>
<span><span class="co"># alphaNL        1.000   623</span></span>
<span><span class="co"># beta_DD_NL     1.000  2910</span></span>
<span><span class="co"># beta_LS_BM     1.000  2366</span></span>
<span><span class="co"># beta_NL_BM     1.000  2198</span></span>
<span><span class="co"># beta_NL_RS     1.002  2819</span></span>
<span><span class="co"># lambdaBM       1.000  1152</span></span>
<span><span class="co"># lambdaDD       1.000  2211</span></span>
<span><span class="co"># lambdaLS       1.000  1630</span></span>
<span><span class="co"># lambdaNL       1.003  1421</span></span>
<span><span class="co"># sigma_BM_phylo 1.000  1183</span></span>
<span><span class="co"># sigma_BM_res   1.000  1493</span></span>
<span><span class="co"># sigma_DD_phylo 1.000  2275</span></span>
<span><span class="co"># sigma_DD_res   1.000  2853</span></span>
<span><span class="co"># sigma_LS_phylo 1.000  1742</span></span>
<span><span class="co"># sigma_LS_res   1.000  2156</span></span>
<span><span class="co"># sigma_NL_phylo 1.002  1307</span></span>
<span><span class="co"># sigma_NL_res   1.002  2183</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># DIC:</span></span>
<span><span class="co"># Mean deviance:  884.1</span></span>
<span><span class="co"># penalty 189.7</span></span>
<span><span class="co"># Penalized deviance: 1074</span></span></code></pre></div>
<div class="section level3">
<h3 id="what-happened-automatically">What happened automatically?<a class="anchor" aria-label="anchor" href="#what-happened-automatically"></a>
</h3>
<p>You will notice two important messages if you run the above
model:</p>
<ol style="list-style-type: decimal">
<li><p><strong>“Detected missing data in predictor-only variables:
BM”</strong> JAGS cannot impute missing values in a “fixed” covariate
data node. To solve this, <code>because</code> automatically adds an
intercept-only equation for the missing predictor (e.g.,
<code>BM ~ 1</code>). This converts <code>BM</code> into a stochastic
node (a response variable) so that JAGS can sample its missing values
during MCMC.</p></li>
<li><p><strong>“Using Latent Variable (GLMM) approach…”</strong> When
variables have missing data, <code>because</code> handles them carefully
to preserve phylogenetic signal. Instead of simple imputation, it uses
an element-wise likelihood that integrates the phylogenetic error
structure, ensuring that the relationships are estimated using the full
phylogenetic information available.</p></li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="inspecting-imputed-values">Inspecting Imputed Values<a class="anchor" aria-label="anchor" href="#inspecting-imputed-values"></a>
</h2>
<p>Since the missing values are now parameters in the model, we can
actually inspect their estimated values (posterior distributions). To do
this, you must run <code><a href="https://rdrr.io/pkg/because/man/because.html" class="external-link">because()</a></code> with the argument
<code>monitor = "all"</code>. This ensures that the imputed stochastic
nodes are saved in the output.</p>
<p>You can use the helper function <code><a href="https://rdrr.io/pkg/because/man/extract_imputed.html" class="external-link">extract_imputed()</a></code> to
easily retrieve these values:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run strictly monitoring 'all' parameters to get imputed values</span></span>
<span><span class="va">sem8_na_monitored.bc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/because/man/because.html" class="external-link">because</a></span><span class="op">(</span></span>
<span>  equations <span class="op">=</span> <span class="va">sem8.eq</span>,</span>
<span>  data <span class="op">=</span> <span class="va">rhino_na</span>,</span>
<span>  structure <span class="op">=</span> <span class="va">rhino.tree</span>,</span>
<span>  monitor <span class="op">=</span> <span class="st">"all"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract posterior summaries for imputed values</span></span>
<span><span class="va">imputed_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/because/man/extract_imputed.html" class="external-link">extract_imputed</a></span><span class="op">(</span><span class="va">sem8_na_monitored.bc</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the first few imputed values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">imputed_values</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#       Variable  ID RowIndex         Mean        SD       Q2.5        Q50</span></span>
<span><span class="co"># Mean        LS s14       14 -0.004710686 0.9342152 -1.8430269 0.02246534</span></span>
<span><span class="co"># Mean1       LS s25       25  1.678043988 1.0829263 -0.4576528 1.73566859</span></span>
<span><span class="co"># Mean2       LS s31       31  0.561576970 1.1507743 -1.6971686 0.57087689</span></span>
<span><span class="co"># Mean3       LS s42       42  1.162445522 1.2150872 -1.3452741 1.13780737</span></span>
<span><span class="co"># Mean4       LS s43       43  2.781955491 1.0852266  0.7474752 2.79039031</span></span>
<span><span class="co"># Mean5       LS s50       50  2.762965171 1.1253402  0.5564907 2.71909773</span></span>
<span><span class="co">#          Q97.5</span></span>
<span><span class="co"># Mean  1.740653</span></span>
<span><span class="co"># Mean1 3.646009</span></span>
<span><span class="co"># Mean2 2.760267</span></span>
<span><span class="co"># Mean3 3.589646</span></span>
<span><span class="co"># Mean4 4.957594</span></span>
<span><span class="co"># Mean5 4.982451</span></span></code></pre></div>
<p>This returns a tidy data frame with the <code>Mean</code>,
<code>SD</code>, and Credible Intervals (<code>Q2.5</code>,
<code>Q97.5</code>) for each missing data point, labeled by the Species
ID.</p>
<p>The variable <code>LS</code> had missing values. In the JAGS model,
the missing values for <code>LS</code> are treated as latent variables.
The variable <code>BM</code> (missing predictor) was converted to a
response variable (<code>BM ~ 1</code>) and also imputed.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Achaz von Hardenberg, Alejandro Gonzalez-Voyer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
