<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Phylogenetic Models ‚Ä¢ because.phybase</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Phylogenetic Models">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">because.phybase</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/03_phylogenetic_models.html">Phylogenetic Models</a></li>
    <li><a class="dropdown-item" href="../articles/04_missing_data.html">Phylogenetic Missing Data Imputation</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://because-pkg.github.io">because</a></li>
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/because-pkg/because.phybase/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Phylogenetic Models</h1>
                        <h4 data-toc-skip class="author">Achaz von
Hardenberg</h4>
            
            <h4 data-toc-skip class="date">2025-12-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/because-pkg/because.phybase/blob/main/vignettes/03_phylogenetic_models.Rmd" class="external-link"><code>vignettes/03_phylogenetic_models.Rmd</code></a></small>
      <div class="d-none name"><code>03_phylogenetic_models.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="back-to-the-rhinograds-phylogenetic-structural-equation-models-phybase-with-because">Back to the Rhinograds: Phylogenetic Structural Equation Models
(PhyBaSE) with <code>because</code><a class="anchor" aria-label="anchor" href="#back-to-the-rhinograds-phylogenetic-structural-equation-models-phybase-with-because"></a>
</h2>
<p>One of the core features of the <code>because</code> package is the
ability to fit Phylogenetic Bayesian Structural Equation models
(PhyBaSE) through the <code>because.phybase</code> module, allowing
researchers to account for shared evolutionary history among species
when analysing the causal relationships among traits.</p>
<p>Once again we will use the Rhinogradentia dataset and tree previously
analysed in Gonzalez-Voyer and von Hardenberg, (2014) and in von
Hardenberg and Gonzalez-Voyer (2025). Let‚Äôs start by loading the
necessary packages and data:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://because-pkg.github.io/because.phybase/">because.phybase</a></span><span class="op">)</span> <span class="co">#the main `because` package will be loaded automatically </span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">rhino.dat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">rhino.tree</span><span class="op">)</span></span></code></pre></div>
<p>While in previous implementations it was necessary to compute the
variance-covariance matrix from the tree and pass it to JAGS,
<code>because</code> handles this internally. You only need to provide
the phylogenetic tree (class <code>phylo</code>) via the
<code>structure</code> argument. Also, <code>because</code>
automatically matches the species names in the data and tree: you only
need to ensure that the species names in the data frame column specified
by <code>species</code> match the tip labels in the tree and provide the
name of the species column to the <code><a href="https://rdrr.io/pkg/because/man/because.html" class="external-link">because()</a></code> function
through the <code>id_col</code> argument. Also, you do not need to
rescale the total tree length to 1 (needed for a correct estimation of
Pagel‚Äôs lambda parameter), as <code>because</code> will handle this
internally.</p>
<p>So, let‚Äôs specify the structural equations of the best model (sem8)
as fitted by von Hardenberg and Gonzalez-Voyer (2025):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sem8_eq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="va">LS</span> <span class="op">~</span> <span class="va">BM</span>,</span>
<span>    <span class="va">NL</span> <span class="op">~</span> <span class="va">BM</span> <span class="op">+</span> <span class="va">RS</span>,</span>
<span>    <span class="va">DD</span> <span class="op">~</span> <span class="va">NL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/because/man/plot_dag.html" class="external-link">plot_dag</a></span><span class="op">(</span><span class="va">sem8_eq</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/sem8.png" class="r-plt" alt="" width="100%"></p>
<p>Now we can fit the model with <code><a href="https://rdrr.io/pkg/because/man/because.html" class="external-link">because()</a></code> including the
phylogenetic tree with the <code>structure</code> argument. Also, as
this is a more complex model than in the previous examples, to speed up
the model fitting we will run 3 chains in parallel using the
<code>parallel = TRUE</code> and <code>n.cores = 3</code> arguments.
Also we will request the WAIC information criterion to be computed by
setting <code>WAIC = TRUE</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_sem8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/because/man/because.html" class="external-link">because</a></span><span class="op">(</span></span>
<span>    equations <span class="op">=</span> <span class="va">sem8_eq</span>,</span>
<span>    data <span class="op">=</span> <span class="va">rhino.dat</span>,</span>
<span>    structure <span class="op">=</span> <span class="va">rhino.tree</span>,</span>
<span>    id_col <span class="op">=</span> <span class="st">"SP"</span>,</span>
<span>    WAIC <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    n.cores <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_sem8</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#                  Mean    SD Naive SE Time-series SE   2.5%    50% 97.5%</span></span>
<span><span class="co"># alphaDD         0.581 0.276    0.005          0.007  0.036  0.582 1.146</span></span>
<span><span class="co"># alphaLS         0.344 0.416    0.008          0.016 -0.490  0.346 1.138</span></span>
<span><span class="co"># alphaNL        -0.055 0.339    0.006          0.015 -0.731 -0.054 0.601</span></span>
<span><span class="co"># beta_DD_NL      0.536 0.074    0.001          0.001  0.390  0.538 0.682</span></span>
<span><span class="co"># beta_LS_BM      0.472 0.085    0.002          0.002  0.309  0.470 0.641</span></span>
<span><span class="co"># beta_NL_BM      0.470 0.068    0.001          0.001  0.336  0.471 0.604</span></span>
<span><span class="co"># beta_NL_RS      0.597 0.068    0.001          0.001  0.461  0.596 0.728</span></span>
<span><span class="co"># lambdaDD        0.462 0.130    0.002          0.003  0.218  0.462 0.717</span></span>
<span><span class="co"># lambdaLS        0.696 0.107    0.002          0.003  0.459  0.709 0.862</span></span>
<span><span class="co"># lambdaNL        0.719 0.086    0.002          0.002  0.533  0.727 0.863</span></span>
<span><span class="co"># sigma_DD_phylo  0.803 0.174    0.003          0.003  0.503  0.790 1.178</span></span>
<span><span class="co"># sigma_DD_res    0.856 0.088    0.002          0.002  0.694  0.852 1.041</span></span>
<span><span class="co"># sigma_LS_phylo  1.253 0.204    0.004          0.005  0.865  1.246 1.675</span></span>
<span><span class="co"># sigma_LS_res    0.804 0.104    0.002          0.002  0.615  0.802 1.013</span></span>
<span><span class="co"># sigma_NL_phylo  1.026 0.145    0.003          0.004  0.766  1.013 1.338</span></span>
<span><span class="co"># sigma_NL_res    0.626 0.075    0.001          0.002  0.490  0.622 0.783</span></span>
<span><span class="co">#                 Rhat n.eff</span></span>
<span><span class="co"># alphaDD        1.000  1408</span></span>
<span><span class="co"># alphaLS        1.003   639</span></span>
<span><span class="co"># alphaNL        1.000   553</span></span>
<span><span class="co"># beta_DD_NL     1.000  3088</span></span>
<span><span class="co"># beta_LS_BM     1.001  2178</span></span>
<span><span class="co"># beta_NL_BM     1.000  2255</span></span>
<span><span class="co"># beta_NL_RS     1.001  2801</span></span>
<span><span class="co"># lambdaDD       1.002  2136</span></span>
<span><span class="co"># lambdaLS       1.000  1595</span></span>
<span><span class="co"># lambdaNL       1.001  1788</span></span>
<span><span class="co"># sigma_DD_phylo 1.002  2741</span></span>
<span><span class="co"># sigma_DD_res   1.000  2712</span></span>
<span><span class="co"># sigma_LS_phylo 1.000  1612</span></span>
<span><span class="co"># sigma_LS_res   1.001  2103</span></span>
<span><span class="co"># sigma_NL_phylo 1.001  1600</span></span>
<span><span class="co"># sigma_NL_res   1.001  2427</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># DIC:</span></span>
<span><span class="co"># Mean deviance:  670 </span></span>
<span><span class="co"># penalty 133.7 </span></span>
<span><span class="co"># Penalized deviance: 803.6 </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># WAIC:</span></span>
<span><span class="co"># WAIC with Standard Errors</span></span>
<span><span class="co"># -------------------------</span></span>
<span><span class="co"># N = 300 observations, 3000 MCMC samples</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#           Estimate   SE</span></span>
<span><span class="co"># elpd_waic   -395.1  9.9</span></span>
<span><span class="co"># p_waic        93.7  5.1</span></span>
<span><span class="co"># waic         790.2 19.8</span></span></code></pre></div>
<p>The output shows that the posterior parameters are consistent with
those we obtained coding the model directly in JAGS (von Hardenberg and
Gonzalez-Voyer, 2025; the code is available in the supplementary
materials of the paper).</p>
<div class="section level3">
<h3 id="the-random-effects-formulation-of-because">The random effects formulation of because<a class="anchor" aria-label="anchor" href="#the-random-effects-formulation-of-because"></a>
</h3>
<p>If you are familiar with the output obtained from that model, you may
however have noticed that besides Pagel‚Äôs
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
parameters for each response variable, with <code><a href="https://rdrr.io/pkg/because/man/because.html" class="external-link">because()</a></code> we
also get estimates of the standard deviations of the phylogenetic and
residual components (<code>sigma_[RESP]_phylo</code> and
<code>sigma_[RESP]_res</code>, respectively). These are estimated
because <code>because</code> uses an optimised random effect formulation
to improve MCMC and significantly reduce runtime. While standard
phylogenetic models must invert the covariance matrix at every iteration
(as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
changes), the random effect approach is mathematically equivalent but
computationally more efficent. <code>because</code> decomposes the
response into three additive components:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><msub><mi>Œº</mi><mi>i</mi></msub><mo>+</mo><msub><mi>u</mi><mi>i</mi></msub><mo>+</mo><msub><mi>œµ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">y_i = \mu_i + u_i + \epsilon_i</annotation></semantics></math></p>
<p>where:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\mu_i</annotation></semantics></math>
is the fixed effect (structural equation mean)</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>u</mi><mi>i</mi></msub><annotation encoding="application/x-tex">u_i</annotation></semantics></math>
is the phylogenetic random effect:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùêÆ</mi><mo>‚àº</mo><mi>ùí©</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>ùüé</mn><mo>,</mo><msubsup><mi>œÉ</mi><mi>u</mi><mn>2</mn></msubsup><mi>ùêï</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{u} \sim \mathcal{N}(\mathbf{0}, \sigma_u^2 \mathbf{V})</annotation></semantics></math>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>œµ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\epsilon_i</annotation></semantics></math>
is the residual error:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùõú</mi><mo>‚àº</mo><mi>ùí©</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>ùüé</mn><mo>,</mo><msubsup><mi>œÉ</mi><mi>e</mi><mn>2</mn></msubsup><mi>ùêà</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\boldsymbol{\epsilon} \sim \mathcal{N}(\mathbf{0}, \sigma_e^2 \mathbf{I})</annotation></semantics></math>
</li>
</ul>
<p>This allows us to pre-compute the inverse phylogenetic
variance-covariance matrix
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>ùêï</mi><mrow><mo>‚àí</mo><mn>1</mn></mrow></msup><annotation encoding="application/x-tex">\mathbf{V}^{-1}</annotation></semantics></math>)
only once and pass it to JAGS as fixed data. JAGS simply scales this
fixed precision matrix by
1/<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œÉ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>,
avoiding costly repeated inversions.</p>
<p>Consequently,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
is derived from the posterior variance components as:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œª</mi><mo>=</mo><mfrac><msubsup><mi>œÉ</mi><mrow><mi>p</mi><mi>h</mi><mi>y</mi><mi>l</mi><mi>o</mi></mrow><mn>2</mn></msubsup><mrow><msubsup><mi>œÉ</mi><mrow><mi>p</mi><mi>h</mi><mi>y</mi><mi>l</mi><mi>o</mi></mrow><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>œÉ</mi><mrow><mi>r</mi><mi>e</mi><mi>s</mi></mrow><mn>2</mn></msubsup></mrow></mfrac></mrow><annotation encoding="application/x-tex">\lambda = \frac{\sigma_{phylo}^2}{\sigma_{phylo}^2 + \sigma_{res}^2}</annotation></semantics></math></p>
<p>This is the approach also used in other packages such as
<code>MCMCglmm</code> (Hadfield, 2010) and <code>brms</code> (B√ºrkner,
2017).</p>
</div>
<div class="section level3">
<h3 id="improved-waic-calculation">Improved WAIC calculation<a class="anchor" aria-label="anchor" href="#improved-waic-calculation"></a>
</h3>
<p>In <code>because</code> we improved the WAIC calculation, compared to
how we calculated it in von Hardenberg &amp; Gonzalez-Voyer, (2025). The
WAIC is now computed directly from the pointwise log-likelihoods
monitored during model fitting, rather than approximating it from the
deviance as done previously. This approach, besides providing more
accurate estimates of the WAIC than the deviance-based approximation
provided by JAGS, also allows us to compute the standard errors for WAIC
(following the method suggested by Vehtari et al.¬†2017) allowing for
more reliable model comparisons.</p>
</div>
<div class="section level3">
<h3 id="testing-conditional-independencies-with-d-separation">Testing conditional independencies with d-separation<a class="anchor" aria-label="anchor" href="#testing-conditional-independencies-with-d-separation"></a>
</h3>
<p>Let‚Äôs now test the conditional independencies implied by the model
(We will set WAIC = FALSE here to speed up the computation, as we do not
need to compare models):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_sem8_dsep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/because/man/because.html" class="external-link">because</a></span><span class="op">(</span></span>
<span>    equations <span class="op">=</span> <span class="va">sem8_eq</span>,</span>
<span>    data <span class="op">=</span> <span class="va">rhino.dat</span>,</span>
<span>    structure <span class="op">=</span> <span class="va">rhino.tree</span>,</span>
<span>    id_col <span class="op">=</span> <span class="st">"SP"</span>,</span>
<span>    dsep <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    WAIC <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    n.cores <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">test_sem8_dsep</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># d-separation Tests</span></span>
<span><span class="co"># ==================</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Test: RS _||_ BM | {}  </span></span>
<span><span class="co">#   Parameter Estimate LowerCI UpperCI Indep    P  Rhat n.eff</span></span>
<span><span class="co">#  beta_RS_BM   -0.029  -0.238   0.177   Yes 0.78 1.002  2177</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Test: RS _||_ DD | {NL} </span></span>
<span><span class="co">#   Parameter Estimate LowerCI UpperCI Indep     P Rhat n.eff</span></span>
<span><span class="co">#  beta_RS_DD   -0.117   -0.33   0.107   Yes 0.301    1  2563</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Test: RS _||_ LS | {BM} </span></span>
<span><span class="co">#   Parameter Estimate LowerCI UpperCI Indep     P Rhat n.eff</span></span>
<span><span class="co">#  beta_RS_LS   -0.019  -0.248    0.22   Yes 0.873    1  2423</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Test: BM _||_ DD | {NL} </span></span>
<span><span class="co">#   Parameter Estimate LowerCI UpperCI Indep     P Rhat n.eff</span></span>
<span><span class="co">#  beta_BM_DD    0.117  -0.111   0.342   Yes 0.322    1  1824</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Test: NL _||_ LS | {RS,BM} </span></span>
<span><span class="co">#   Parameter Estimate LowerCI UpperCI Indep    P Rhat n.eff</span></span>
<span><span class="co">#  beta_NL_LS    0.013  -0.151   0.177   Yes 0.86    1  2134</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Test: DD _||_ LS | {NL,BM} </span></span>
<span><span class="co">#   Parameter Estimate LowerCI UpperCI Indep     P  Rhat n.eff</span></span>
<span><span class="co">#  beta_DD_LS   -0.063  -0.245   0.114   Yes 0.495 1.002  2693</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Legend:</span></span>
<span><span class="co">#   Indep: 'Yes' = Conditionally Independent, 'No' = Dependent (based on 95% CI)</span></span>
<span><span class="co">#   P: Bayesian probability that the posterior distribution overlaps with zero</span></span></code></pre></div>
<p>As expected, all conditional independencies are supported, indicating
that the the hypothesised causal structure is consistent with the
data.</p>
</div>
<div class="section level3">
<h3 id="accounting-for-measurement-error-in-traits-in-phybase-models">Accounting for measurement error in traits in PhyBaSE models<a class="anchor" aria-label="anchor" href="#accounting-for-measurement-error-in-traits-in-phybase-models"></a>
</h3>
<p>In von Hardenberg and Gonzalez-Voyer (2025), we showed how PhyBaSE
models can be specified to account for measurement error in the traits.
These models can also be fitted with <code><a href="https://rdrr.io/pkg/because/man/because.html" class="external-link">because()</a></code>. In the case
you have available repeated measures per species, it is sufficient to
provide the data frame with all measurements (i.e.¬†multiple rows per
species) and specify the <code>id_col</code> argument to indicate the
species identifier column. <code><a href="https://rdrr.io/pkg/because/man/because.html" class="external-link">because()</a></code> will automatically
format the data to create a response matrix with species in rows and
replicates in columns, padding with <code>NA</code>s as necessary. We
will use the same data simulated in von Hardenberg and Gonzalez-Voyer
(2025) for this example. Each trait was transformed to a distribution
with mean equal to the original species trait value in
<code>rhino.dat</code> and SD equal to a proportion (25%) of the
among-species variance for that trait. Then 10 repeated measures were
sampled for each species. The resulting data frame
<code>RhinoMulti.dat</code> contains 1000 rows (10 replicates for each
of the 100 species) and 6 columns (species identifier and 5 traits).
Let‚Äôs load the data and fit the same model as before accounting for the
repeated measures:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://because-pkg.github.io/because/" class="external-link">because</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">RhinoMulti.dat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">rhino.tree</span><span class="op">)</span></span>
<span></span>
<span><span class="va">RhinoMulti.eq</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="va">LS</span> <span class="op">~</span> <span class="va">BM</span>,</span>
<span>    <span class="va">NL</span> <span class="op">~</span> <span class="va">BM</span> <span class="op">+</span> <span class="va">RS</span>,</span>
<span>    <span class="va">DD</span> <span class="op">~</span> <span class="va">NL</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">RhinoMulti.bc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/because/man/because.html" class="external-link">because</a></span><span class="op">(</span></span>
<span>  equations <span class="op">=</span> <span class="va">RhinoMulti.eq</span>,</span>
<span>  data <span class="op">=</span> <span class="va">RhinoMulti.dat</span>,</span>
<span>  structure <span class="op">=</span> <span class="va">rhino.tree</span>,</span>
<span>  id_col <span class="op">=</span> <span class="st">"SP"</span>, <span class="co"># species identifier column</span></span>
<span>  variability <span class="op">=</span> <span class="st">"reps"</span>, <span class="co"># specify that data contains repeated measures</span></span>
<span>  parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n.cores <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">RhinoMulti.bc</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#                  Mean    SD Naive SE Time-series SE   2.5%    50%</span></span>
<span><span class="co"># alphaDD         0.593 0.291    0.005          0.008  0.043  0.588</span></span>
<span><span class="co"># alphaLS         0.381 0.394    0.007          0.016 -0.384  0.384</span></span>
<span><span class="co"># alphaNL        -0.084 0.321    0.006          0.012 -0.722 -0.085</span></span>
<span><span class="co"># beta_DD_NL      0.539 0.079    0.001          0.001  0.383  0.539</span></span>
<span><span class="co"># beta_LS_BM      0.446 0.084    0.002          0.002  0.287  0.445</span></span>
<span><span class="co"># beta_NL_BM      0.466 0.068    0.001          0.001  0.333  0.465</span></span>
<span><span class="co"># beta_NL_RS      0.592 0.069    0.001          0.001  0.463  0.592</span></span>
<span><span class="co"># lambdaDD        0.484 0.134    0.002          0.003  0.221  0.485</span></span>
<span><span class="co"># lambdaLS        0.698 0.106    0.002          0.003  0.453  0.708</span></span>
<span><span class="co"># lambdaNL        0.696 0.091    0.002          0.002  0.503  0.705</span></span>
<span><span class="co"># sigma_DD_phylo  0.826 0.178    0.003          0.004  0.516  0.813</span></span>
<span><span class="co"># sigma_DD_res    0.842 0.094    0.002          0.002  0.668  0.839</span></span>
<span><span class="co"># sigma_LS_phylo  1.249 0.206    0.004          0.005  0.869  1.234</span></span>
<span><span class="co"># sigma_LS_res    0.796 0.105    0.002          0.002  0.607  0.790</span></span>
<span><span class="co"># sigma_NL_phylo  0.997 0.146    0.003          0.004  0.739  0.986</span></span>
<span><span class="co"># sigma_NL_res    0.644 0.079    0.001          0.002  0.501  0.641</span></span>
<span><span class="co">#.                97.5%  Rhat n.eff</span></span>
<span><span class="co"># alphaDD        1.171 1.000  1295</span></span>
<span><span class="co"># alphaLS        1.140 1.000   655</span></span>
<span><span class="co"># alphaNL        0.545 1.001   744</span></span>
<span><span class="co"># beta_DD_NL     0.693 1.000  2902</span></span>
<span><span class="co"># beta_LS_BM     0.609 1.000  2205</span></span>
<span><span class="co"># beta_NL_BM     0.602 1.001  2320</span></span>
<span><span class="co"># beta_NL_RS     0.729 1.001  2916</span></span>
<span><span class="co"># lambdaDD       0.735 1.000  1970</span></span>
<span><span class="co"># lambdaLS       0.872 1.000  1448</span></span>
<span><span class="co"># lambdaNL       0.853 1.000  1653</span></span>
<span><span class="co"># sigma_DD_phylo 1.210 1.000  2057</span></span>
<span><span class="co"># sigma_DD_res   1.039 1.000  2370</span></span>
<span><span class="co"># sigma_LS_phylo 1.682 1.000  1445</span></span>
<span><span class="co"># sigma_LS_res   1.021 1.000  1907</span></span>
<span><span class="co"># sigma_NL_phylo 1.307 1.001  1503</span></span>
<span><span class="co"># sigma_NL_res   0.816 1.000  2363</span></span></code></pre></div>
<p>In von Hardenberg and Gonzalez-Voyer (2025) we showed also how to
account for measurement error when only a single observation per species
is available, but the measurement standard error is known. This can also
be done with <code><a href="https://rdrr.io/pkg/because/man/because.html" class="external-link">because()</a></code> by providing for each trait a second
collumn called <code>[TRAIT]_se</code> containing the standard error of
the measurements for each species.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://because-pkg.github.io/because/" class="external-link">because</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">RhinoMulti_se.dat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">rhino.tree</span><span class="op">)</span></span>
<span></span>
<span><span class="va">RhinoMulti_se.bc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/because/man/because.html" class="external-link">because</a></span><span class="op">(</span></span>
<span>  equations <span class="op">=</span> <span class="va">RhinoMulti.eq</span>,</span>
<span>  data <span class="op">=</span> <span class="va">RhinoMulti_se.dat</span>,</span>
<span>  structure <span class="op">=</span> <span class="va">rhino.tree</span>,</span>
<span>  id_col <span class="op">=</span> <span class="st">"SP"</span>,</span>
<span>  variability <span class="op">=</span> <span class="st">"se"</span>, <span class="co"># specify that data contains standard errors</span></span>
<span>  parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n.cores <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">RhinoMulti_se.bc</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#                  Mean    SD Naive SE Time-series SE   2.5%    50% 97.5%  Rhat</span></span>
<span><span class="co"># alphaDD         0.581 0.289    0.005          0.008  0.003  0.577 1.132 1.002</span></span>
<span><span class="co"># alphaLS         0.372 0.412    0.008          0.016 -0.435  0.373 1.188 1.003</span></span>
<span><span class="co"># alphaNL        -0.117 0.352    0.006          0.015 -0.821 -0.125 0.587 1.002</span></span>
<span><span class="co"># beta_DD_NL      0.541 0.077    0.001          0.001  0.392  0.541 0.691 1.000</span></span>
<span><span class="co"># beta_LS_BM      0.442 0.086    0.002          0.002  0.275  0.441 0.612 1.000</span></span>
<span><span class="co"># beta_NL_BM      0.466 0.069    0.001          0.002  0.331  0.465 0.603 1.000</span></span>
<span><span class="co"># beta_NL_RS      0.591 0.069    0.001          0.002  0.450  0.591 0.721 1.000</span></span>
<span><span class="co"># lambdaDD        0.492 0.135    0.002          0.003  0.238  0.494 0.751 1.001</span></span>
<span><span class="co"># lambdaLS        0.700 0.105    0.002          0.003  0.463  0.713 0.866 1.006</span></span>
<span><span class="co"># lambdaNL        0.701 0.090    0.002          0.002  0.505  0.709 0.854 1.000</span></span>
<span><span class="co"># sigma_DD_phylo  0.833 0.181    0.003          0.004  0.515  0.823 1.224 1.000</span></span>
<span><span class="co"># sigma_DD_res    0.832 0.091    0.002          0.002  0.663  0.828 1.017 1.000</span></span>
<span><span class="co"># sigma_LS_phylo  1.252 0.201    0.004          0.005  0.872  1.240 1.666 1.010</span></span>
<span><span class="co"># sigma_LS_res    0.796 0.106    0.002          0.002  0.602  0.790 1.020 1.002</span></span>
<span><span class="co"># sigma_NL_phylo  1.005 0.148    0.003          0.004  0.743  0.996 1.326 1.000</span></span>
<span><span class="co"># sigma_NL_res    0.642 0.078    0.001          0.002  0.500  0.640 0.808 1.000</span></span>
<span><span class="co">#                n.eff</span></span>
<span><span class="co"># alphaDD         1237</span></span>
<span><span class="co"># alphaLS          647</span></span>
<span><span class="co"># alphaNL          579</span></span>
<span><span class="co"># beta_DD_NL      2969</span></span>
<span><span class="co"># beta_LS_BM      1712</span></span>
<span><span class="co"># beta_NL_BM      2036</span></span>
<span><span class="co"># beta_NL_RS      2055</span></span>
<span><span class="co"># lambdaDD        2086</span></span>
<span><span class="co"># lambdaLS        1571</span></span>
<span><span class="co"># lambdaNL        1454</span></span>
<span><span class="co"># sigma_DD_phylo  2147</span></span>
<span><span class="co"># sigma_DD_res    2561</span></span>
<span><span class="co"># sigma_LS_phylo  1553</span></span>
<span><span class="co"># sigma_LS_res    2205</span></span>
<span><span class="co"># sigma_NL_phylo  1501</span></span>
<span><span class="co"># sigma_NL_res    2184</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="accounting-for-uncertainity-in-the-phylogenetic-tree">Accounting for uncertainity in the phylogenetic tree<a class="anchor" aria-label="anchor" href="#accounting-for-uncertainity-in-the-phylogenetic-tree"></a>
</h2>
<p>In cases where there is uncertainty about the phylogenetic
relationships among species, <code>because</code> allows users to fit
models across a sample of trees as described in von Hardenberg and
Gonzalez Voyer, 2025). With <code>because</code> this becomes trivial:
You just need to provide a list of phylogenetic trees (class
<code>multiPhylo</code>) to the <code>structure</code> argument instead
of a single tree; <code>because</code> will then randomly sample one
tree from the list at each MCMC iteration, effectively integrating over
phylogenetic uncertainty when estimating model parameters.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>von Hardenberg, A. and Gonzalez-Voyer, A. (2025). PhyBaSE: A Bayesian
approach to Phylogenetic Structural Equation Models. <em>Methods in
Ecology and Evolution</em>. <a href="https://doi.org/10.1111/2041-210X.70044" class="external-link uri">https://doi.org/10.1111/2041-210X.70044</a></p>
<p>Vehtari, A., Gelman, A., &amp; Gabry, J. (2017). Practical Bayesian
model evaluation using leave-one-out cross-validation and WAIC.
<em>Statistics and Computing</em>, 27(5), 1413-1432.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Achaz von Hardenberg, Alejandro Gonzalez-Voyer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
